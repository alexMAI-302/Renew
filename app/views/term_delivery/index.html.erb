<% content_for :js_controller do %>
,'TermDelivery'
<% end -%>
<% content_for :stylesheets do %>

<% end %>

<% content_for :title do %>
	Инкассация терминалов
<% end %>

<% content_for :js do %>
	<%= javascript_include_tag :defaults %>
		// <script>
									// function start_update(tid){
									// $('spinner_errortext_'+tid).show();
									// $('term_errortext_'+tid).update('Подождите пожалуйста, идет расчет.....');
									// };
			// </script>
// 							
// 							
	// <script type="text/javascript" charset="utf-8">
		// var mode='base';
		// var term=0;
		// function on_super_select_zone(e)
		// {
			// <% @rst_route.each do	|a| %>
				// $('zone_' + <%=  a["zone"] %>).style.backgroundColor = 'yellow';
				// $$('tr.term_'+<%=  a["zone"] %>).each(function(d){
						// d.style.display='';
				// });
// 				
			// <% end %>				
// 			
		// };
		// function on_route_click(sid){
			// if ( mode == 'move' ) return;
			// $$('input.zone_check_'+sid).each(function(d){
						// if ($('r_'+sid+'_needsave').checked)
							// d.value='1'
						// else
							// d.value='0'
			// })		
		// };
// 		
		// function on_super_route_click(e){
			// if ( mode == 'move' ) return;
			// <% @rst_route.each do	|a| %>
				// $('r_'+<%=  a["zone"] %>+'_needsave').checked = $('super_needsave').checked;
				// on_route_click(<%=  a["zone"] %>);
			// <% end %>
		// };
// 		
// 		
// 		
		// function on_route_check(sid,e){
			// if ( mode == 'move' ) return;	
			// if ($('r_'+sid+'_delivery').value<0) {
				// $('r_'+sid+'_delivery_status4').checked = !$('r_'+sid+'_delivery_status4').checked;
				// alert("По данному маршруту ещё не создана доставка");
			// };
// 				
			// if (!$('r_'+sid+'_delivery_status4').checked  && $('r_'+sid+'_delivery_status4_right').value == '0') {
				// $('r_'+sid+'_delivery_status4').checked = true;
				// alert("Нельзя снимать галку ИЗ с маршрута без прав на группу Снятие галки ИЗ в маршруте");
			// }
// 			
// 			
		// };
// 		
// 			
		// function on_select_zone( sid,e ){
			// if ( mode == 'move' ) return;
			// if (e.shiftKey)
				// if ($('zone_' + sid ).style.backgroundColor == 'yellow')
					// $('zone_' + sid ).style.backgroundColor ='transparent'
				// else
					// $('zone_' + sid ).style.backgroundColor = 'yellow'
			// else
			// {
// 					
// 				
			// $$('tr.zone').each(function(d){
					// d.style.backgroundColor = 'transparent';
				// });
				// $('zone_' + sid ).style.backgroundColor = 'yellow';
			// }
// 			
			// <% @rst_route.each do	|a| %>
				// if ($('zone_' + <%=  a["zone"] %>).style.backgroundColor == 'yellow')
				// {
					// $$('tr.term_'+<%=  a["zone"] %>).each(function(d){
						// d.style.display='';
						// })
				// }
				// else
				// {
					// $$('tr.term_'+<%=  a["zone"] %>).each(function(d){
						// d.style.display='none';
						// })
				// }
			// <% end %>	
// 		
		// };
		// function on_term_click(zone,row){
			// var a = '';
			// var b = '';
			// if ( mode != 'move' ) 
			// {
				// if ($('a_'+row+'_termsave').checked)
					// $('zone_'+zone).cells[3].textContent = $('zone_'+zone).cells[3].textContent -0 +1;
				// else
					// $('zone_'+zone).cells[3].textContent -= 1;		
// 				
				// $('a_'+terminal+'_modified').value = 1;
			// }
			// else
			// {
				// $$('input.termsave').each(function(d){
						// if (d.checked )
						// {
							// a=a+d.parentNode.parentNode.cells[3].textContent+', ';
							// b=b+'<a><a><zone_old>'+d.parentNode.parentNode.cells[0].children[2].value+'</zone_old><zone>'+$('m_to_zone').value+'</zone><terminalid>'+d.parentNode.parentNode.cells[3].textContent+'</terminalid></a></a>';
						// }
					// })	
				// $('term_to_move_v').value=a;
				// $('m_term_to_move').value='<hash>'+b+'</hash>';
			// }
// 			
		// };
		// function switch_mode(value,e){
			// if ( mode == 'move' ) 
				// return;
			// if (value != -666) 
			// {
				// $('term_commit').style.display='none';
				// $('iz_commit').style.display='none';
				// $('move_commit').style.display='';
				// $('move_clear').style.display='';
				// on_super_select_zone(e);
			// }
			// $$('input.termsave').each(function(d){
						// if (d.checked )
							// d.checked = false;
									// })	
// 			
			// mode = 'move';
		// };
		// function on_move_clear(e){
			// if ( mode == 'move' ) 
			// {
				// $('term_to_move_v').value;
				// $$('input.termsave').each(function(d){ if (d.checked ) d.checked = false; });			
			// }
// 			
		// };
// 		
		// function on_term_info_click(sid,e){
			// var info
			// info = $('term_'+sid).cells[12].textContent
			// $('term_'+sid).cells[12].innerHTML='<input id="a_'+sid+'_info" name="a['+sid+'][info]" type="text" value="'+info+'">';
// 			
		// };
		// function on_terminal_break_change(e)
		// {
			// if (term !=0)
			// {
				// $('a_'+term+'_terminal_break').value =	$('c_terminal_break').value;			
				// var objSel = document.getElementById('c_terminal_break');
				// for (var i=0; i < objSel.options.length; i++)
				// {
					// if (objSel.options[i].selected)
					// {
						// $('term_'+term).cells[14].textContent = objSel.options[i].text;
						// break;
					// }
				// }
				// $('a_'+term+'_modified').value = 1;
// 				
			// }
		// };
		// function on_techinfo_change(e)
		// {
			// if (term !=0)
			// {
				// <% if !(@spv_id==5626) and !(@save_osh==0) -%>
					// $('a_'+term+'_techinfo').value =	$('techinfo').value;					
					// $('term_'+term).cells[15].textContent =  $('techinfo').value
					// $('a_'+term+'_penaltystatus').value = $('c_penaltystatus').value;
					// $('a_'+term+'_penaltystatus').checked = $('c_penaltystatus').checked;
// 				
				// <% end -%>
				// $('a_'+term+'_terminal_break').value = $('c_terminal_break').value
				// $('term_'+term).cells[11].textContent =  $('c_terminal_break').options[$('c_terminal_break').selectedIndex].label;
				// <% if !(@spv_id==5626) -%>
					// $('a_'+term+'_servstatus').value = $('c_servstatus').value;
					// $('a_'+term+'_servstatus').checked = $('c_servstatus').checked;
				// <% end -%>
				// $('a_'+term+'_modified').value = 1;
			// }
		// };
		// function on_select_terminal(row,e)
		// {
			// var objSel = document.getElementById('c_terminal_break');
			// var len = objSel.options.length;
			// if (term) 
			// {
				// $('term_'+term).style.borderStyle = '';
			// }
			// $('term_'+row).style.borderStyle = 'solid';
			// term = row
// 			
			// if (!$('a_'+row+'_terminal_break').value)
				// objSel.options[objSel.options.length - 1].selected = true;
				// else
					// for (var i=0; i < objSel.options.length; i++)
					// {
						// objSel.options[i].selected = false;
						// if (objSel.options[i].value == $('a_'+row+'_terminal_break').value)
						// {
							// objSel.options[i].selected = true;
							// break;
						// }
					// }
// 				
				// $('c_terminal_break').value = $('a_'+row+'_terminal_break').value;
// 				
			// <% if !(@spv_id==5626) and !(@save_osh==0) -%>
				// $('techinfo').value = $('a_'+row+'_techinfo').value;
				// $('c_penaltystatus').value = $('a_'+row+'_penaltystatus').value ;
				// $('c_penaltystatus').checked = $('a_'+row+'_penaltystatus').checked ;
			// <% end -%>
// 
			// <% if !(@spv_id==5626) -%>
				// $('c_servstatus').value = $('a_'+row+'_servstatus').value ;
				// $('c_servstatus').checked = $('a_'+row+'_servstatus').checked ;
			// <% end -%>
// 			
		// };
	// </script>
	// <script>
		// function start_proc(tid){
			// $('spinner'+tid).show();
			// $('row_'+tid).update('Подождите пожалуйста, идет расчет.....');
		// };
	// </script>
// 	
	// <script type="text/javascript">
	// <!--
	// /*
	// originally written by paul sowden <paulidontsmoke.co.uk> | http://idontsmoke.co.uk
	// modified and localized by alexander shurkayev <alshur@ya.ru> | http://htmlcssjs.ru
	// */
// 	
	// var img_dir = "/images/sort_"; // папка с картинками
	// var sort_case_sensitive = false; // вид сортировки (регистрозависимый или нет)
// 	
	// // ф-ция, определяющая алгоритм сортировки
	// function _sort(a, b) {
		// var a = a[0];
		// var b = b[0];
		// var _a = (a + '').replace(/,/, '.');
		// var _b = (b + '').replace(/,/, '.');
		// if (a.indexOf("/")>0  )
		// {
			// var da = a.substr(3,3)+a.substr(0,2)+a.substr(5);
			// var db = b.substr(3,3)+b.substr(0,2)+b.substr(5);
			// if (Date.parse(da) && Date.parse(db)) return sort_numbers( Date.parse(db), Date.parse(da));
		// }
		// if (parseFloat(_a) && parseFloat(_b)) return sort_numbers(parseFloat(_a), parseFloat(_b));
		// else if (!sort_case_sensitive) return sort_insensitive(a, b);
		// else return sort_sensitive(a, b);
	// }
// 
	// // ф-ция сортировки чисел
	// function sort_numbers(a, b) {
		// return a - b;
	// }
// 
	// // ф-ция регистронезависимой сортировки
	// function sort_insensitive(a, b) {
		// var anew = a.toLowerCase();
		// var bnew = b.toLowerCase();
		// if (anew < bnew) return -1;
		// if (anew > bnew) return 1;
		// return 0;
	// }
// 
	// // ф-ция регистрозависимой сортировки
	// function sort_sensitive(a, b) {
		// if (a < b) return -1;
		// if (a > b) return 1;
		// return 0;
	// }
// 
	// // вспомогательная ф-ция, выдирающая из дочерних узлов весь текст
	// function getConcatenedTextContent(node) {
		// var _result = "";
		// if (node == null) {
        // return _result;
		// }
		// var childrens = node.childNodes;
		// var i = 0;
		// while (i < childrens.length) {
			// var child = childrens.item(i);
			// switch (child.nodeType) {
				// case 1: // ELEMENT_NODE
				// case 5: // ENTITY_REFERENCE_NODE
					// _result += getConcatenedTextContent(child);
					// break;
				// case 3: // TEXT_NODE
				// case 2: // ATTRIBUTE_NODE
				// case 4: // CDATA_SECTION_NODE
					// _result += child.nodeValue;
					// break;
				// case 6: // ENTITY_NODE
				// case 7: // PROCESSING_INSTRUCTION_NODE
				// case 8: // COMMENT_NODE
				// case 9: // DOCUMENT_NODE
				// case 10: // DOCUMENT_TYPE_NODE
				// case 11: // DOCUMENT_FRAGMENT_NODE
				// case 12: // NOTATION_NODE
				// // skip
            // break;
        // }
        // i++;
    // }
    // return _result;
// }
// 
// // суть скрипта
// function sort(e) {
    // var el = window.event ? window.event.srcElement : e.currentTarget;
    // while (el.tagName.toLowerCase() != "td") el = el.parentNode;
    // var a = new Array();
    // var name = el.lastChild.nodeValue;
    // var dad = el.parentNode;
    // var table = dad.parentNode.parentNode;
    // var up = table.up;
    // var node, arrow, curcol;
    // for (var i = 0; (node = dad.getElementsByTagName("td").item(i)); i++) {
		// if (node.style.display == 'none') {continue}
        // if (node.lastChild.nodeValue == name){
            // curcol = i;
            // if (node.className == "curcol"){
                // arrow = node.firstChild;
                // table.up = Number(!up);
            // }else{
                // node.className = "curcol";
                // arrow = node.insertBefore(document.createElement("img"),node.firstChild);
                // table.up = 0;
            // }
            // arrow.src = img_dir + table.up + ".gif";
            // arrow.alt = "";
        // }else{
            // if (node.className == "curcol"){
                // node.className = "";
                // if (node.firstChild) node.removeChild(node.firstChild);
            // }
        // }
	// }
    // var tbody = table.getElementsByTagName("tbody").item(0);
    // for (var i = 0; (node = tbody.getElementsByTagName("tr").item(i)); i++) {
		// if (node.style.display == 'none') {continue};
        // a[i] = new Array();
        // a[i][0] = getConcatenedTextContent(node.getElementsByTagName("td").item(curcol));
        // a[i][1] = getConcatenedTextContent(node.getElementsByTagName("td").item(1));
        // a[i][2] = getConcatenedTextContent(node.getElementsByTagName("td").item(0));
        // a[i][3] = node;
    // }
    // a.sort(_sort);
    // if (table.up) a.reverse();
    // for (var i = 0; i < a.length; i++) {
		// if (a[i])
		// {
			// //if node = tbody.getElementsByTagName("tr").item(i);
			// //if (node.style.display == 'none') {continue}
			// tbody.appendChild(a[i][3]);
		// }
    // }
// }
// 
// // ф-ция инициализации всего процесса
// function init(e) {
    // if (!document.getElementsByTagName) return;
// 
    // for (var j = 0; (thead = document.getElementsByTagName("thead").item(j)); j++) {
        // var node;
        // for (var i = 0; (node = thead.getElementsByTagName("td").item(i)); i++) {
            // if (node.addEventListener) node.addEventListener("click", sort, false);
            // else if (node.attachEvent) node.attachEvent("onclick", sort);
            // node.title = "Нажмите на заголовок, чтобы отсортировать колонку";
        // }
        // thead.parentNode.up = 0;
//         
        // if (typeof(initial_sort_id) != "undefined"){
            // td_for_event = thead.getElementsByTagName("td").item(initial_sort_id);
            // if (document.createEvent){
                // var evt = document.createEvent("MouseEvents");
                // evt.initMouseEvent("click", false, false, window, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, td_for_event);
                // td_for_event.dispatchEvent(evt);
            // } else if (td_for_event.fireEvent) td_for_event.fireEvent("onclick");
            // if (typeof(initial_sort_up) != "undefined" && initial_sort_up){
                // if (td_for_event.dispatchEvent) td_for_event.dispatchEvent(evt);
                // else if (td_for_event.fireEvent) td_for_event.fireEvent("onclick");
            // }
        // }
    // }
// }
// 
// // запускаем ф-цию init() при возникновении события load
// var root = window.addEventListener || window.attachEvent ? window : document.addEventListener ? document : null;
// if (root){
    // if (root.addEventListener) root.addEventListener("load", init, false);
    // else if (root.attachEvent) root.attachEvent("onload", init);
// }
// //-->
<% end %>